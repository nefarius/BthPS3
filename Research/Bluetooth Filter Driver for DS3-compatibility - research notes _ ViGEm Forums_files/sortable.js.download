(function(t){"use strict";if(typeof define==="function"&&define.amd){define(["jquery","./mouse","../data","../ie","../scroll-parent","../version","../widget"],t)}else{t(jQuery)}})(function(t){"use strict";return t.widget("ui.sortable",t.ui.mouse,{version:"1.13.1",widgetEventPrefix:"sort",ready:false,options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:"auto",cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:"> *",opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(t,e,i){return t>=e&&t<e+i},_isFloating:function(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function(){this.containerCache={};this._addClass("ui-sortable");this.refresh();this.offset=this.element.offset();this._mouseInit();this._setHandleClassName();this.ready=true},_setOption:function(t,e){this._super(t,e);if(t==="handle"){this._setHandleClassName()}},_setHandleClassName:function(){var e=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle");t.each(this.items,function(){e._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--){this.items[t].item.removeData(this.widgetName+"-item")}return this},_mouseCapture:function(e,i){var s=null,r=false,o=this;if(this.reverting){return false}if(this.options.disabled||this.options.type==="static"){return false}this._refreshItems(e);t(e.target).parents().each(function(){if(t.data(this,o.widgetName+"-item")===o){s=t(this);return false}});if(t.data(e.target,o.widgetName+"-item")===o){s=t(e.target)}if(!s){return false}if(this.options.handle&&!i){t(this.options.handle,s).find("*").addBack().each(function(){if(this===e.target){r=true}});if(!r){return false}}this.currentItem=s;this._removeCurrentsFromItems();return true},_mouseStart:function(e,i,s){var r,o,n=this.options;this.currentContainer=this;this.refreshPositions();this.appendTo=t(n.appendTo!=="parent"?n.appendTo:this.currentItem.parent());this.helper=this._createHelper(e);this._cacheHelperProportions();this._cacheMargins();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},relative:this._getRelativeOffset()});this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");if(n.cursorAt){this._adjustOffsetFromHelper(n.cursorAt)}this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};if(this.helper[0]!==this.currentItem[0]){this.currentItem.hide()}this._createPlaceholder();this.scrollParent=this.placeholder.scrollParent();t.extend(this.offset,{parent:this._getParentOffset()});if(n.containment){this._setContainment()}if(n.cursor&&n.cursor!=="auto"){o=this.document.find("body");this.storedCursor=o.css("cursor");o.css("cursor",n.cursor);this.storedStylesheet=t("<style>*{ cursor: "+n.cursor+" !important; }</style>").appendTo(o)}if(n.zIndex){if(this.helper.css("zIndex")){this._storedZIndex=this.helper.css("zIndex")}this.helper.css("zIndex",n.zIndex)}if(n.opacity){if(this.helper.css("opacity")){this._storedOpacity=this.helper.css("opacity")}this.helper.css("opacity",n.opacity)}if(this.scrollParent[0]!==this.document[0]&&this.scrollParent[0].tagName!=="HTML"){this.overflowOffset=this.scrollParent.offset()}this._trigger("start",e,this._uiHash());if(!this._preserveHelperProportions){this._cacheHelperProportions()}if(!s){for(r=this.containers.length-1;r>=0;r--){this.containers[r]._trigger("activate",e,this._uiHash(this))}}if(t.ui.ddmanager){t.ui.ddmanager.current=this}if(t.ui.ddmanager&&!n.dropBehaviour){t.ui.ddmanager.prepareOffsets(this,e)}this.dragging=true;this._addClass(this.helper,"ui-sortable-helper");if(!this.helper.parent().is(this.appendTo)){this.helper.detach().appendTo(this.appendTo);this.offset.parent=this._getParentOffset()}this.position=this.originalPosition=this._generatePosition(e);this.originalPageX=e.pageX;this.originalPageY=e.pageY;this.lastPositionAbs=this.positionAbs=this._convertPositionTo("absolute");this._mouseDrag(e);return true},_scroll:function(t){var e=this.options,i=false;if(this.scrollParent[0]!==this.document[0]&&this.scrollParent[0].tagName!=="HTML"){if(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<e.scrollSensitivity){this.scrollParent[0].scrollTop=i=this.scrollParent[0].scrollTop+e.scrollSpeed}else if(t.pageY-this.overflowOffset.top<e.scrollSensitivity){this.scrollParent[0].scrollTop=i=this.scrollParent[0].scrollTop-e.scrollSpeed}if(this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<e.scrollSensitivity){this.scrollParent[0].scrollLeft=i=this.scrollParent[0].scrollLeft+e.scrollSpeed}else if(t.pageX-this.overflowOffset.left<e.scrollSensitivity){this.scrollParent[0].scrollLeft=i=this.scrollParent[0].scrollLeft-e.scrollSpeed}}else{if(t.pageY-this.document.scrollTop()<e.scrollSensitivity){i=this.document.scrollTop(this.document.scrollTop()-e.scrollSpeed)}else if(this.window.height()-(t.pageY-this.document.scrollTop())<e.scrollSensitivity){i=this.document.scrollTop(this.document.scrollTop()+e.scrollSpeed)}if(t.pageX-this.document.scrollLeft()<e.scrollSensitivity){i=this.document.scrollLeft(this.document.scrollLeft()-e.scrollSpeed)}else if(this.window.width()-(t.pageX-this.document.scrollLeft())<e.scrollSensitivity){i=this.document.scrollLeft(this.document.scrollLeft()+e.scrollSpeed)}}return i},_mouseDrag:function(e){var i,s,r,o,n=this.options;this.position=this._generatePosition(e);this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!=="y"){this.helper[0].style.left=this.position.left+"px"}if(!this.options.axis||this.options.axis!=="x"){this.helper[0].style.top=this.position.top+"px"}if(n.scroll){if(this._scroll(e)!==false){this._refreshItemPositions(true);if(t.ui.ddmanager&&!n.dropBehaviour){t.ui.ddmanager.prepareOffsets(this,e)}}}this.dragDirection={vertical:this._getDragVerticalDirection(),horizontal:this._getDragHorizontalDirection()};for(i=this.items.length-1;i>=0;i--){s=this.items[i];r=s.item[0];o=this._intersectsWithPointer(s);if(!o){continue}if(s.instance!==this.currentContainer){continue}if(r!==this.currentItem[0]&&this.placeholder[o===1?"next":"prev"]()[0]!==r&&!t.contains(this.placeholder[0],r)&&(this.options.type==="semi-dynamic"?!t.contains(this.element[0],r):true)){this.direction=o===1?"down":"up";if(this.options.tolerance==="pointer"||this._intersectsWithSides(s)){this._rearrange(e,s)}else{break}this._trigger("change",e,this._uiHash());break}}this._contactContainers(e);if(t.ui.ddmanager){t.ui.ddmanager.drag(this,e)}this._trigger("sort",e,this._uiHash());this.lastPositionAbs=this.positionAbs;return false},_mouseStop:function(e,i){if(!e){return}if(t.ui.ddmanager&&!this.options.dropBehaviour){t.ui.ddmanager.drop(this,e)}if(this.options.revert){var s=this,r=this.placeholder.offset(),o=this.options.axis,n={};if(!o||o==="x"){n.left=r.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)}if(!o||o==="y"){n.top=r.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)}this.reverting=true;t(this.helper).animate(n,parseInt(this.options.revert,10)||500,function(){s._clear(e)})}else{this._clear(e,i)}return false},cancel:function(){if(this.dragging){this._mouseUp(new t.Event("mouseup",{target:null}));if(this.options.helper==="original"){this.currentItem.css(this._storedCSS);this._removeClass(this.currentItem,"ui-sortable-helper")}else{this.currentItem.show()}for(var e=this.containers.length-1;e>=0;e--){this.containers[e]._trigger("deactivate",null,this._uiHash(this));if(this.containers[e].containerCache.over){this.containers[e]._trigger("out",null,this._uiHash(this));this.containers[e].containerCache.over=0}}}if(this.placeholder){if(this.placeholder[0].parentNode){this.placeholder[0].parentNode.removeChild(this.placeholder[0])}if(this.options.helper!=="original"&&this.helper&&this.helper[0].parentNode){this.helper.remove()}t.extend(this,{helper:null,dragging:false,reverting:false,_noFinalSort:null});if(this.domPosition.prev){t(this.domPosition.prev).after(this.currentItem)}else{t(this.domPosition.parent).prepend(this.currentItem)}}return this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];e=e||{};t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);if(i){s.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}});if(!s.length&&e.key){s.push(e.key+"=")}return s.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];e=e||{};i.each(function(){s.push(t(e.item||this).attr(e.attribute||"id")||"")});return s},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,s=this.positionAbs.top,r=s+this.helperProportions.height,o=t.left,n=o+t.width,h=t.top,a=h+t.height,l=this.offset.click.top,c=this.offset.click.left,f=this.options.axis==="x"||s+l>h&&s+l<a,p=this.options.axis==="y"||e+c>o&&e+c<n,u=f&&p;if(this.options.tolerance==="pointer"||this.options.forcePointerForContainers||this.options.tolerance!=="pointer"&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]){return u}else{return o<e+this.helperProportions.width/2&&i-this.helperProportions.width/2<n&&h<s+this.helperProportions.height/2&&r-this.helperProportions.height/2<a}},_intersectsWithPointer:function(t){var e,i,s=this.options.axis==="x"||this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),r=this.options.axis==="y"||this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),o=s&&r;if(!o){return false}e=this.dragDirection.vertical;i=this.dragDirection.horizontal;return this.floating?i==="right"||e==="down"?2:1:e&&(e==="down"?2:1)},_intersectsWithSides:function(t){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),s=this.dragDirection.vertical,r=this.dragDirection.horizontal;if(this.floating&&r){return r==="right"&&i||r==="left"&&!i}else{return s&&(s==="down"&&e||s==="up"&&!e)}},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return t!==0&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return t!==0&&(t>0?"right":"left")},refresh:function(t){this._refreshItems(t);this._setHandleClassName();this.refreshPositions();return this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){var i,s,r,o,n=[],h=[],a=this._connectWith();if(a&&e){for(i=a.length-1;i>=0;i--){r=t(a[i],this.document[0]);for(s=r.length-1;s>=0;s--){o=t.data(r[s],this.widgetFullName);if(o&&o!==this&&!o.options.disabled){h.push([typeof o.options.items==="function"?o.options.items.call(o.element):t(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o])}}}}h.push([typeof this.options.items==="function"?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);function l(){n.push(this)}for(i=h.length-1;i>=0;i--){h[i][0].each(l)}return t(n)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;i<e.length;i++){if(e[i]===t.item[0]){return false}}return true})},_refreshItems:function(e){this.items=[];this.containers=[this];var i,s,r,o,n,h,a,l,c=this.items,f=[[typeof this.options.items==="function"?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],p=this._connectWith();if(p&&this.ready){for(i=p.length-1;i>=0;i--){r=t(p[i],this.document[0]);for(s=r.length-1;s>=0;s--){o=t.data(r[s],this.widgetFullName);if(o&&o!==this&&!o.options.disabled){f.push([typeof o.options.items==="function"?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]);this.containers.push(o)}}}}for(i=f.length-1;i>=0;i--){n=f[i][1];h=f[i][0];for(s=0,l=h.length;s<l;s++){a=t(h[s]);a.data(this.widgetName+"-item",n);c.push({item:a,instance:n,width:0,height:0,left:0,top:0})}}},_refreshItemPositions:function(e){var i,s,r,o;for(i=this.items.length-1;i>=0;i--){s=this.items[i];if(this.currentContainer&&s.instance!==this.currentContainer&&s.item[0]!==this.currentItem[0]){continue}r=this.options.toleranceElement?t(this.options.toleranceElement,s.item):s.item;if(!e){s.width=r.outerWidth();s.height=r.outerHeight()}o=r.offset();s.left=o.left;s.top=o.top}},refreshPositions:function(t){this.floating=this.items.length?this.options.axis==="x"||this._isFloating(this.items[0].item):false;if(this.offsetParent&&this.helper){this.offset.parent=this._getParentOffset()}this._refreshItemPositions(t);var e,i;if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this)}else{for(e=this.containers.length-1;e>=0;e--){i=this.containers[e].element.offset();this.containers[e].containerCache.left=i.left;this.containers[e].containerCache.top=i.top;this.containers[e].containerCache.width=this.containers[e].element.outerWidth();this.containers[e].containerCache.height=this.containers[e].element.outerHeight()}}return this},_createPlaceholder:function(e){e=e||this;var i,s,r=e.options;if(!r.placeholder||r.placeholder.constructor===String){i=r.placeholder;s=e.currentItem[0].nodeName.toLowerCase();r.placeholder={element:function(){var r=t("<"+s+">",e.document[0]);e._addClass(r,"ui-sortable-placeholder",i||e.currentItem[0].className)._removeClass(r,"ui-sortable-helper");if(s==="tbody"){e._createTrPlaceholder(e.currentItem.find("tr").eq(0),t("<tr>",e.document[0]).appendTo(r))}else if(s==="tr"){e._createTrPlaceholder(e.currentItem,r)}else if(s==="img"){r.attr("src",e.currentItem.attr("src"))}if(!i){r.css("visibility","hidden")}return r},update:function(t,o){if(i&&!r.forcePlaceholderSize){return}if(!o.height()||r.forcePlaceholderSize&&(s==="tbody"||s==="tr")){o.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10))}if(!o.width()){o.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10))}}}}e.placeholder=t(r.placeholder.element.call(e.element,e.currentItem));e.currentItem.after(e.placeholder);r.placeholder.update(e,e.placeholder)},_createTrPlaceholder:function(e,i){var s=this;e.children().each(function(){t("<td>&#160;</td>",s.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(e){var i,s,r,o,n,h,a,l,c,f,p=null,u=null;for(i=this.containers.length-1;i>=0;i--){if(t.contains(this.currentItem[0],this.containers[i].element[0])){continue}if(this._intersectsWith(this.containers[i].containerCache)){if(p&&t.contains(this.containers[i].element[0],p.element[0])){continue}p=this.containers[i];u=i}else{if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",e,this._uiHash(this));this.containers[i].containerCache.over=0}}}if(!p){return}if(this.containers.length===1){if(!this.containers[u].containerCache.over){this.containers[u]._trigger("over",e,this._uiHash(this));this.containers[u].containerCache.over=1}}else{r=1e4;o=null;c=p.floating||this._isFloating(this.currentItem);n=c?"left":"top";h=c?"width":"height";f=c?"pageX":"pageY";for(s=this.items.length-1;s>=0;s--){if(!t.contains(this.containers[u].element[0],this.items[s].item[0])){continue}if(this.items[s].item[0]===this.currentItem[0]){continue}a=this.items[s].item.offset()[n];l=false;if(e[f]-a>this.items[s][h]/2){l=true}if(Math.abs(e[f]-a)<r){r=Math.abs(e[f]-a);o=this.items[s];this.direction=l?"up":"down"}}if(!o&&!this.options.dropOnEmpty){return}if(this.currentContainer===this.containers[u]){if(!this.currentContainer.containerCache.over){this.containers[u]._trigger("over",e,this._uiHash());this.currentContainer.containerCache.over=1}return}if(o){this._rearrange(e,o,null,true)}else{this._rearrange(e,null,this.containers[u].element,true)}this._trigger("change",e,this._uiHash());this.containers[u]._trigger("change",e,this._uiHash(this));this.currentContainer=this.containers[u];this.options.placeholder.update(this.currentContainer,this.placeholder);this.scrollParent=this.placeholder.scrollParent();if(this.scrollParent[0]!==this.document[0]&&this.scrollParent[0].tagName!=="HTML"){this.overflowOffset=this.scrollParent.offset()}this.containers[u]._trigger("over",e,this._uiHash(this));this.containers[u].containerCache.over=1}},_createHelper:function(e){var i=this.options,s=typeof i.helper==="function"?t(i.helper.apply(this.element[0],[e,this.currentItem])):i.helper==="clone"?this.currentItem.clone():this.currentItem;if(!s.parents("body").length){this.appendTo[0].appendChild(s[0])}if(s[0]===this.currentItem[0]){this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}}if(!s[0].style.width||i.forceHelperSize){s.width(this.currentItem.width())}if(!s[0].style.height||i.forceHelperSize){s.height(this.currentItem.height())}return s},_adjustOffsetFromHelper:function(t){if(typeof t==="string"){t=t.split(" ")}if(Array.isArray(t)){t={left:+t[0],top:+t[1]||0}}if("left"in t){this.offset.click.left=t.left+this.margins.left}if("right"in t){this.offset.click.left=this.helperProportions.width-t.right+this.margins.left}if("top"in t){this.offset.click.top=t.top+this.margins.top}if("bottom"in t){this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();if(this.cssPosition==="absolute"&&this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])){e.left+=this.scrollParent.scrollLeft();e.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==="html"&&t.ui.ie){e={top:0,left:0}}return{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition==="relative"){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else{return{top:0,left:0}}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,r=this.options;if(r.containment==="parent"){r.containment=this.helper[0].parentNode}if(r.containment==="document"||r.containment==="window"){this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,r.containment==="document"?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,(r.containment==="document"?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]}if(!/^(document|window|parent)$/.test(r.containment)){e=t(r.containment)[0];i=t(r.containment).offset();s=t(e).css("overflow")!=="hidden";this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(e,i){if(!i){i=this.position}var s=e==="absolute"?1:-1,r=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,o=/(html|body)/i.test(r[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():o?0:r.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():o?0:r.scrollLeft())*s}},_generatePosition:function(e){var i,s,r=this.options,o=e.pageX,n=e.pageY,h=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,a=/(html|body)/i.test(h[0].tagName);if(this.cssPosition==="relative"&&!(this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0])){this.offset.relative=this._getRelativeOffset()}if(this.originalPosition){if(this.containment){if(e.pageX-this.offset.click.left<this.containment[0]){o=this.containment[0]+this.offset.click.left}if(e.pageY-this.offset.click.top<this.containment[1]){n=this.containment[1]+this.offset.click.top}if(e.pageX-this.offset.click.left>this.containment[2]){o=this.containment[2]+this.offset.click.left}if(e.pageY-this.offset.click.top>this.containment[3]){n=this.containment[3]+this.offset.click.top}}if(r.grid){i=this.originalPageY+Math.round((n-this.originalPageY)/r.grid[1])*r.grid[1];n=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-r.grid[1]:i+r.grid[1]:i;s=this.originalPageX+Math.round((o-this.originalPageX)/r.grid[0])*r.grid[0];o=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-r.grid[0]:s+r.grid[0]:s}}return{top:n-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():a?0:h.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():a?0:h.scrollLeft())}},_rearrange:function(t,e,i,s){if(i){i[0].appendChild(this.placeholder[0])}else{e.item[0].parentNode.insertBefore(this.placeholder[0],this.direction==="down"?e.item[0]:e.item[0].nextSibling)}this.counter=this.counter?++this.counter:1;var r=this.counter;this._delay(function(){if(r===this.counter){this.refreshPositions(!s)}})},_clear:function(t,e){this.reverting=false;var i,s=[];if(!this._noFinalSort&&this.currentItem.parent().length){this.placeholder.before(this.currentItem)}this._noFinalSort=null;if(this.helper[0]===this.currentItem[0]){for(i in this._storedCSS){if(this._storedCSS[i]==="auto"||this._storedCSS[i]==="static"){this._storedCSS[i]=""}}this.currentItem.css(this._storedCSS);this._removeClass(this.currentItem,"ui-sortable-helper")}else{this.currentItem.show()}if(this.fromOutside&&!e){s.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))})}if((this.fromOutside||this.domPosition.prev!==this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!==this.currentItem.parent()[0])&&!e){s.push(function(t){this._trigger("update",t,this._uiHash())})}if(this!==this.currentContainer){if(!e){s.push(function(t){this._trigger("remove",t,this._uiHash())});s.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer));s.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer))}}function r(t,e,i){return function(s){i._trigger(t,s,e._uiHash(e))}}for(i=this.containers.length-1;i>=0;i--){if(!e){s.push(r("deactivate",this,this.containers[i]))}if(this.containers[i].containerCache.over){s.push(r("out",this,this.containers[i]));this.containers[i].containerCache.over=0}}if(this.storedCursor){this.document.find("body").css("cursor",this.storedCursor);this.storedStylesheet.remove()}if(this._storedOpacity){this.helper.css("opacity",this._storedOpacity)}if(this._storedZIndex){this.helper.css("zIndex",this._storedZIndex==="auto"?"":this._storedZIndex)}this.dragging=false;if(!e){this._trigger("beforeStop",t,this._uiHash())}this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(!this.cancelHelperRemoval){if(this.helper[0]!==this.currentItem[0]){this.helper.remove()}this.helper=null}if(!e){for(i=0;i<s.length;i++){s[i].call(this,t)}this._trigger("stop",t,this._uiHash())}this.fromOutside=false;return!this.cancelHelperRemoval},_trigger:function(){if(t.Widget.prototype._trigger.apply(this,arguments)===false){this.cancel()}},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}})});
//# sourceMappingURL=sortable.js.map